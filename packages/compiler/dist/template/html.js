"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseHTML = parseHTML;

var _htmlparser = require("htmlparser2");

var _Node = _interopRequireDefault(require("./Node"));

var _TextNode = _interopRequireDefault(require("./TextNode"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function prepareHTML(html) {
  return html.replace(/\t/g, ' ').replace(/\s\s+/g, ' ').trim();
}

function initStack() {
  return [new _Node.default({
    tag: 'ParserBody',
    children: []
  })];
}

function parseHTML(html) {
  function currentStackNode() {
    return stack[stack.length - 1];
  }

  html = prepareHTML(html);
  var stack = initStack();
  var parse = new _htmlparser.Parser({
    onopentag: function onopentag(name, attrs) {
      var parent = currentStackNode();
      var node = new _Node.default({
        tag: name,
        attrs: attrs,
        children: []
      });

      if (parent) {
        parent.appendChild(node);
      }

      stack.push(node);
    },
    ontext: function ontext(text) {
      var parent = currentStackNode();
      text = text.trim();

      if (text !== '' && parent) {
        var node = new _TextNode.default(text);

        if (parent) {
          parent.appendChild(node);
        }
      }
    },
    onclosetag: function onclosetag(name) {
      stack.pop();
    }
  }, {
    decodeEntities: true
  });
  parse.write(html);
  parse.end();
  return stack[0];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wbGF0ZS9odG1sLmpzIl0sIm5hbWVzIjpbInByZXBhcmVIVE1MIiwiaHRtbCIsInJlcGxhY2UiLCJ0cmltIiwiaW5pdFN0YWNrIiwiTm9kZSIsInRhZyIsImNoaWxkcmVuIiwicGFyc2VIVE1MIiwiY3VycmVudFN0YWNrTm9kZSIsInN0YWNrIiwibGVuZ3RoIiwicGFyc2UiLCJQYXJzZXIiLCJvbm9wZW50YWciLCJuYW1lIiwiYXR0cnMiLCJwYXJlbnQiLCJub2RlIiwiYXBwZW5kQ2hpbGQiLCJwdXNoIiwib250ZXh0IiwidGV4dCIsIlRleHROb2RlIiwib25jbG9zZXRhZyIsInBvcCIsImRlY29kZUVudGl0aWVzIiwid3JpdGUiLCJlbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7OztBQUdBLFNBQVNBLFdBQVQsQ0FBcUJDLElBQXJCLEVBQ0E7QUFDQyxTQUFPQSxJQUFJLENBQUNDLE9BQUwsQ0FBYSxLQUFiLEVBQW9CLEdBQXBCLEVBQXlCQSxPQUF6QixDQUFpQyxRQUFqQyxFQUEyQyxHQUEzQyxFQUFnREMsSUFBaEQsRUFBUDtBQUNBOztBQUVELFNBQVNDLFNBQVQsR0FDQTtBQUNDLFNBQU8sQ0FDTixJQUFJQyxhQUFKLENBQVM7QUFDUkMsSUFBQUEsR0FBRyxFQUFFLFlBREc7QUFFUkMsSUFBQUEsUUFBUSxFQUFFO0FBRkYsR0FBVCxDQURNLENBQVA7QUFNQTs7QUFFTSxTQUFTQyxTQUFULENBQW1CUCxJQUFuQixFQUNQO0FBQ0MsV0FBU1EsZ0JBQVQsR0FDQTtBQUNDLFdBQU9DLEtBQUssQ0FBQ0EsS0FBSyxDQUFDQyxNQUFOLEdBQWUsQ0FBaEIsQ0FBWjtBQUNBOztBQUVEVixFQUFBQSxJQUFJLEdBQUdELFdBQVcsQ0FBQ0MsSUFBRCxDQUFsQjtBQUVBLE1BQUlTLEtBQUssR0FBR04sU0FBUyxFQUFyQjtBQUVBLE1BQU1RLEtBQUssR0FBRyxJQUFJQyxrQkFBSixDQUFXO0FBRXhCQyxJQUFBQSxTQUZ3QixxQkFFZEMsSUFGYyxFQUVSQyxLQUZRLEVBR3hCO0FBQ0MsVUFBSUMsTUFBTSxHQUFHUixnQkFBZ0IsRUFBN0I7QUFFQSxVQUFJUyxJQUFJLEdBQUcsSUFBSWIsYUFBSixDQUFTO0FBQ25CQyxRQUFBQSxHQUFHLEVBQUVTLElBRGM7QUFFbkJDLFFBQUFBLEtBQUssRUFBRUEsS0FGWTtBQUduQlQsUUFBQUEsUUFBUSxFQUFFO0FBSFMsT0FBVCxDQUFYOztBQU1BLFVBQUdVLE1BQUgsRUFBVztBQUNWQSxRQUFBQSxNQUFNLENBQUNFLFdBQVAsQ0FBbUJELElBQW5CO0FBQ0E7O0FBRURSLE1BQUFBLEtBQUssQ0FBQ1UsSUFBTixDQUFXRixJQUFYO0FBQ0EsS0FqQnVCO0FBbUJ4QkcsSUFBQUEsTUFuQndCLGtCQW1CakJDLElBbkJpQixFQW9CeEI7QUFDQyxVQUFJTCxNQUFNLEdBQUdSLGdCQUFnQixFQUE3QjtBQUVBYSxNQUFBQSxJQUFJLEdBQUdBLElBQUksQ0FBQ25CLElBQUwsRUFBUDs7QUFFQSxVQUFHbUIsSUFBSSxLQUFLLEVBQVQsSUFBZUwsTUFBbEIsRUFBMEI7QUFDekIsWUFBSUMsSUFBSSxHQUFHLElBQUlLLGlCQUFKLENBQWFELElBQWIsQ0FBWDs7QUFDQSxZQUFHTCxNQUFILEVBQVc7QUFDVkEsVUFBQUEsTUFBTSxDQUFDRSxXQUFQLENBQW1CRCxJQUFuQjtBQUNBO0FBQ0U7QUFDRCxLQS9Cb0I7QUFpQ3hCTSxJQUFBQSxVQWpDd0Isc0JBaUNiVCxJQWpDYSxFQWtDeEI7QUFDQ0wsTUFBQUEsS0FBSyxDQUFDZSxHQUFOO0FBQ0c7QUFwQ29CLEdBQVgsRUFzQ1g7QUFBRUMsSUFBQUEsY0FBYyxFQUFFO0FBQWxCLEdBdENXLENBQWQ7QUF3Q0FkLEVBQUFBLEtBQUssQ0FBQ2UsS0FBTixDQUFZMUIsSUFBWjtBQUNBVyxFQUFBQSxLQUFLLENBQUNnQixHQUFOO0FBRUEsU0FBT2xCLEtBQUssQ0FBQyxDQUFELENBQVo7QUFDQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhcnNlciB9IGZyb20gJ2h0bWxwYXJzZXIyJztcbmltcG9ydCBOb2RlIGZyb20gJy4vTm9kZSc7XG5pbXBvcnQgVGV4dE5vZGUgZnJvbSAnLi9UZXh0Tm9kZSc7XG5cblxuZnVuY3Rpb24gcHJlcGFyZUhUTUwoaHRtbClcbntcblx0cmV0dXJuIGh0bWwucmVwbGFjZSgvXFx0L2csICcgJykucmVwbGFjZSgvXFxzXFxzKy9nLCAnICcpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gaW5pdFN0YWNrKClcbntcblx0cmV0dXJuIFtcblx0XHRuZXcgTm9kZSh7XG5cdFx0XHR0YWc6ICdQYXJzZXJCb2R5Jyxcblx0XHRcdGNoaWxkcmVuOiBbXSxcblx0XHR9KVxuXHRdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VIVE1MKGh0bWwpXG57XG5cdGZ1bmN0aW9uIGN1cnJlbnRTdGFja05vZGUoKVxuXHR7XG5cdFx0cmV0dXJuIHN0YWNrW3N0YWNrLmxlbmd0aCAtIDFdO1xuXHR9XG5cblx0aHRtbCA9IHByZXBhcmVIVE1MKGh0bWwpO1xuXG5cdGxldCBzdGFjayA9IGluaXRTdGFjaygpO1xuXG5cdGNvbnN0IHBhcnNlID0gbmV3IFBhcnNlcih7XG5cdFx0XG5cdFx0b25vcGVudGFnKG5hbWUsIGF0dHJzKVxuXHRcdHtcblx0XHRcdGxldCBwYXJlbnQgPSBjdXJyZW50U3RhY2tOb2RlKCk7XG5cblx0XHRcdGxldCBub2RlID0gbmV3IE5vZGUoe1xuXHRcdFx0XHR0YWc6IG5hbWUsXG5cdFx0XHRcdGF0dHJzOiBhdHRycyxcblx0XHRcdFx0Y2hpbGRyZW46IFtdLFxuXHRcdFx0fSk7XG5cblx0XHRcdGlmKHBhcmVudCkge1xuXHRcdFx0XHRwYXJlbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHR9XG5cblx0XHRcdHN0YWNrLnB1c2gobm9kZSk7XG5cdFx0fSxcblxuXHRcdG9udGV4dCh0ZXh0KVxuXHRcdHtcblx0XHRcdGxldCBwYXJlbnQgPSBjdXJyZW50U3RhY2tOb2RlKCk7XG5cblx0XHRcdHRleHQgPSB0ZXh0LnRyaW0oKTtcblxuXHRcdFx0aWYodGV4dCAhPT0gJycgJiYgcGFyZW50KSB7XG5cdFx0XHRcdGxldCBub2RlID0gbmV3IFRleHROb2RlKHRleHQpO1xuXHRcdFx0XHRpZihwYXJlbnQpIHtcblx0XHRcdFx0XHRwYXJlbnQuYXBwZW5kQ2hpbGQobm9kZSk7XG5cdFx0XHRcdH1cblx0ICAgIFx0fVxuXHQgICAgfSxcblxuXHRcdG9uY2xvc2V0YWcobmFtZSlcblx0XHR7XG5cdFx0XHRzdGFjay5wb3AoKTtcblx0ICAgIH1cblxuXHR9LCB7IGRlY29kZUVudGl0aWVzOiB0cnVlIH0pXG5cdFxuXHRwYXJzZS53cml0ZShodG1sKTtcblx0cGFyc2UuZW5kKCk7XG5cblx0cmV0dXJuIHN0YWNrWzBdO1xufVxuIl19