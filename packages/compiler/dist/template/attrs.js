"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.prepareOptionKey = prepareOptionKey;
exports.handleAttrsValue = handleAttrsValue;
exports.parseAttrs = parseAttrs;
exports.parseOptionKey = parseOptionKey;
exports.parseOptionValue = parseOptionValue;

var _expression = require("./expression");

var AttrsMap = {
  'style': 'staticStyle',
  'class': 'staticClass',
  ':style': 'dynamicStyle',
  ':class': 'dynamicClass'
};
var HTMLAttributes = ['id', 'name', 'value', 'placeholder'];
/**
 * There are some type of expressions (javascript code)
 * 1. @click="expr" -> _methods.submitForm();
 * 2. :style="expr" -> ['test', _state.some, _computed.some]  ||  ['test', _data.paddingTop]
 * 3. :class="expr" -> { is-loading: _state.loading }  ||  { is-red: _data.red }
 * 4. v-if="expr" -> _data.type === 'type'  ||  _state.visible === true
 *
 * In render function should be 
 * 1. _methods.submitForm();
 * 2. style(['test', _state.some(), _computed.some() ])  ||  ['test', _data.paddingTop]  SHOULD NOT BE CALLED BECAUSE REACTIVE
 * 3. 
 * 4.  _data.type  ||  () => { return _state.visible() } OR _state.visible
 * 
 * @return {[type]}         [description]
 */

function parseOptionValue(context, key, value) {
  var statefull = false;
  var keepObservation = false;
  var isExpression = false;

  if (key[0] === '$') {
    return {
      value: value,
      statefull: statefull
    };
  }

  if (key[0] === '@') {
    isExpression = true;
    statefull = true;
  }

  if (key[0] === ':') {
    isExpression = true;
  }

  if (typeof value === 'object') {
    keepObservation = true;
  }

  if (key[0] === '_') {
    value = '`' + value.replace(/{{((?:(?!(}})).)+)}}/g, '${$1}') + '`';
    keepObservation = true;
    isExpression = true;
  }

  if (!isExpression) {
    return {
      value: "'" + value + "'",
      statefull: false
    };
  }

  var exp = (0, _expression.expression)(context, value, keepObservation);
  value = exp.value;

  if (!statefull && exp.statefull) {
    statefull = true;
  }

  return {
    value: value,
    statefull: statefull
  };
}

function parseOptionKey(key, value) {
  if (AttrsMap[key]) {
    return AttrsMap[key];
  } else if (key[0] === '@') {
    return key.replace(/@/g, 'on');
  }

  return key;
}

function parseStyles(string) {
  var styles = {};
  var pairs = string.replace(/\s/g, '').split(';');

  for (var i = 0; i < pairs.length; i++) {
    var tmp = pairs[i].split(':');

    if (tmp.length === 2) {
      styles[tmp[0]] = tmp[1];
    }
  }

  return styles;
}

function prepareOptionKey(variable) {
  if (variable.match(/\-/g)) {
    variable = "'" + variable + "'";
  }

  return variable;
}
/**
 * Make a map and return a function for checking if a key
 * is in that map.
 */


function makeMap(str, expectsLowerCase) {
  var map = Object.create(null);
  var list = str.split(',');

  for (var i = 0; i < list.length; i++) {
    map[list[i]] = true;
  }

  return expectsLowerCase ? function (val) {
    return map[val.toLowerCase()];
  } : function (val) {
    return map[val];
  };
}
/**
 * [dynamicArgAttribute description]
 * @type {RegExp}
 */


var dynamicArgAttribute = /^(\@|\:)/g;
var eventArgAttribute = /^\@/g;
/**
 * Keep options while hydration
 * e.g events, static class, props
 * @type {Array}
 */

var isHydrationKeepAttr = makeMap('staticClass, staticStyle, props, on');
var isFunctionAttr = makeMap('key, ref');
var isAttr = makeMap('accept,accept-charset,accesskey,action,align,alt,async,autocomplete,' + 'autofocus,autoplay,autosave,bgcolor,border,buffered,challenge,charset,' + 'checked,cite,class,code,codebase,color,cols,colspan,content,http-equiv,' + 'name,contenteditable,contextmenu,controls,coords,data,datetime,default,' + 'defer,dir,dirname,disabled,download,draggable,dropzone,enctype,method,for,' + 'form,formaction,headers,height,hidden,high,href,hreflang,http-equiv,' + 'icon,id,ismap,itemprop,keytype,kind,label,lang,language,list,loop,low,' + 'manifest,max,maxlength,media,method,GET,POST,min,multiple,email,file,' + 'muted,name,novalidate,open,optimum,pattern,ping,placeholder,poster,' + 'preload,radiogroup,readonly,rel,required,reversed,rows,rowspan,sandbox,' + 'scope,scoped,seamless,selected,shape,size,type,text,password,sizes,span,' + 'spellcheck,src,srcdoc,srclang,srcset,start,step,style,summary,tabindex,' + 'target,title,type,usemap,value,width,wrap');
var isNotCallable = makeMap('');

var isEventAttr = function isEventAttr(name) {
  return name.match(eventArgAttribute);
};

var isCSSAttr = function isCSSAttr(name) {
  return name.match(/^\:?(style|class)$/g);
};

var isRenderableAttr = function isRenderableAttr(name) {
  return isAttr(name) || name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;
};

var isArgNotHydratable = function isArgNotHydratable(type, arg) {
  if (type === null) {
    type = arg;
  }

  return !isHydrationKeepAttr(type);
};

var normalizeValue = function normalizeValue(value) {
  if (value === '') {
    value = true;
  }

  if (typeof value !== 'boolean') {
    value = "\"" + value + "\"";
  }

  return value;
};

function handleAttrsValue(context, value, shouldBeCallable) {
  if (shouldBeCallable === void 0) {
    shouldBeCallable = true;
  }

  var statefull = false;
  var exp = (0, _expression.expression)(context, value, shouldBeCallable);
  value = exp.value;

  if (!statefull && exp.statefull) {
    statefull = true;
  }

  return {
    value: value,
    statefull: statefull
  };
}

function genOptions(options) {
  var result = '';

  for (var key in options) {
    var value = options[key];

    if (typeof options[key] === 'object') {
      value = genOptions(value);

      if (value === null) {
        continue;
      }

      result += "'" + key + "': { \n " + value + " \n},\n";
    } else {
      if (value == '') {
        continue;
      }

      result += "'" + key + "': " + value + ",\n";
    }
  }

  if (result == '') {
    return null;
  }

  return result;
}

function parseAttrs(context, attrs, hydrate) {
  if (hydrate === void 0) {
    hydrate = false;
  }

  var shouldOptionsHydrate = false;
  var options = {
    staticClass: '',
    staticStyle: {},
    class: [],
    style: [],
    attrs: {},
    on: {},
    domProps: {},
    props: {}
  };

  for (var key in attrs) {
    var arg = key.replace(dynamicArgAttribute, '');
    var attrValue = attrs[key];

    if (arg.match(/^v\-/g)) {
      continue;
    }

    if (key.match(dynamicArgAttribute)) {
      var _handleAttrsValue = handleAttrsValue(context, attrValue, !isNotCallable(arg)),
          value = _handleAttrsValue.value,
          statefull = _handleAttrsValue.statefull;

      var type = false;

      if (isEventAttr(key)) {
        type = 'on';
        statefull = true;
      } else if (isFunctionAttr(arg)) {
        type = null;
      } else {
        if (isCSSAttr(key)) {
          type = null;
          statefull = true;
        } else if (isRenderableAttr(arg)) {
          type = 'attrs';
        } else {
          type = 'props';
        }
      }

      if (statefull) {
        shouldOptionsHydrate = true;
      }

      if (type === false) {
        continue;
      }

      if (hydrate && !statefull && isArgNotHydratable(type, arg)) {
        continue;
      }

      if (type === null) {
        options[arg] = value;
      } else {
        options[type][arg] = value;
      }
    } else {
      var _value = attrValue;
      var normalizedValue = null;
      var _type = false;

      if (arg === 'class') {
        arg = 'staticClass';
        _type = null;
        normalizedValue = normalizeValue(_value);
      } else if (arg === 'style') {
        arg = 'staticStyle';
        _type = null;
        normalizedValue = {};
        _value = _value.split(';');

        for (var i = 0; i < _value.length; i++) {
          var tmp = _value[i].split(':').map(function (item) {
            return item.trim();
          });

          if (tmp.length === 2) {
            normalizedValue[tmp[0]] = normalizeValue(tmp[1]);
          }
        }
      } else if (isFunctionAttr(arg)) {
        throw new Error("Attribute " + arg + " should by dynamic");
      } else if (isRenderableAttr(arg)) {
        _type = 'attrs';
        normalizedValue = normalizeValue(_value);
      } else {
        _type = 'props';
        normalizedValue = normalizeValue(_value);
      }

      if (_type === false) {
        continue;
      }

      if (hydrate && isArgNotHydratable(_type, arg)) {
        continue;
      }

      if (_type === null) {
        options[arg] = normalizedValue;
      } else {
        options[_type][arg] = normalizedValue;
      }
    } // Is expression inside

  } // if(hydrate) {
  // 	if(options.class.length === 0) {
  // 		delete options.staticClass;
  // 	}
  // 	if(options.style.length === 0) {
  // 		delete options.staticStyle;
  // 	}
  // }
  // console.log(options);
  // console.log(genOptions(options));
  // console.log(shouldOptionsHydrate);


  options = genOptions(options);
  return {
    options: options === null ? '' : options,
    shouldOptionsHydrate: shouldOptionsHydrate
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZW1wbGF0ZS9hdHRycy5qcyJdLCJuYW1lcyI6WyJBdHRyc01hcCIsIkhUTUxBdHRyaWJ1dGVzIiwicGFyc2VPcHRpb25WYWx1ZSIsImNvbnRleHQiLCJrZXkiLCJ2YWx1ZSIsInN0YXRlZnVsbCIsImtlZXBPYnNlcnZhdGlvbiIsImlzRXhwcmVzc2lvbiIsInJlcGxhY2UiLCJleHAiLCJwYXJzZU9wdGlvbktleSIsInBhcnNlU3R5bGVzIiwic3RyaW5nIiwic3R5bGVzIiwicGFpcnMiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJ0bXAiLCJwcmVwYXJlT3B0aW9uS2V5IiwidmFyaWFibGUiLCJtYXRjaCIsIm1ha2VNYXAiLCJzdHIiLCJleHBlY3RzTG93ZXJDYXNlIiwibWFwIiwiT2JqZWN0IiwiY3JlYXRlIiwibGlzdCIsInZhbCIsInRvTG93ZXJDYXNlIiwiZHluYW1pY0FyZ0F0dHJpYnV0ZSIsImV2ZW50QXJnQXR0cmlidXRlIiwiaXNIeWRyYXRpb25LZWVwQXR0ciIsImlzRnVuY3Rpb25BdHRyIiwiaXNBdHRyIiwiaXNOb3RDYWxsYWJsZSIsImlzRXZlbnRBdHRyIiwibmFtZSIsImlzQ1NTQXR0ciIsImlzUmVuZGVyYWJsZUF0dHIiLCJpbmRleE9mIiwiaXNBcmdOb3RIeWRyYXRhYmxlIiwidHlwZSIsImFyZyIsIm5vcm1hbGl6ZVZhbHVlIiwiaGFuZGxlQXR0cnNWYWx1ZSIsInNob3VsZEJlQ2FsbGFibGUiLCJnZW5PcHRpb25zIiwib3B0aW9ucyIsInJlc3VsdCIsInBhcnNlQXR0cnMiLCJhdHRycyIsImh5ZHJhdGUiLCJzaG91bGRPcHRpb25zSHlkcmF0ZSIsInN0YXRpY0NsYXNzIiwic3RhdGljU3R5bGUiLCJjbGFzcyIsInN0eWxlIiwib24iLCJkb21Qcm9wcyIsInByb3BzIiwiYXR0clZhbHVlIiwibm9ybWFsaXplZFZhbHVlIiwiaXRlbSIsInRyaW0iLCJFcnJvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFF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JztcblxuY29uc3QgQXR0cnNNYXAgPSB7XG5cdCdzdHlsZSc6ICdzdGF0aWNTdHlsZScsXG5cdCdjbGFzcyc6ICdzdGF0aWNDbGFzcycsXG5cdCc6c3R5bGUnOiAnZHluYW1pY1N0eWxlJyxcblx0JzpjbGFzcyc6ICdkeW5hbWljQ2xhc3MnLFxufTtcblxuY29uc3QgSFRNTEF0dHJpYnV0ZXMgPSBbJ2lkJywgJ25hbWUnLCAndmFsdWUnLCAncGxhY2Vob2xkZXInXTtcblxuLyoqXG4gKiBUaGVyZSBhcmUgc29tZSB0eXBlIG9mIGV4cHJlc3Npb25zIChqYXZhc2NyaXB0IGNvZGUpXG4gKiAxLiBAY2xpY2s9XCJleHByXCIgLT4gX21ldGhvZHMuc3VibWl0Rm9ybSgpO1xuICogMi4gOnN0eWxlPVwiZXhwclwiIC0+IFsndGVzdCcsIF9zdGF0ZS5zb21lLCBfY29tcHV0ZWQuc29tZV0gIHx8ICBbJ3Rlc3QnLCBfZGF0YS5wYWRkaW5nVG9wXVxuICogMy4gOmNsYXNzPVwiZXhwclwiIC0+IHsgaXMtbG9hZGluZzogX3N0YXRlLmxvYWRpbmcgfSAgfHwgIHsgaXMtcmVkOiBfZGF0YS5yZWQgfVxuICogNC4gdi1pZj1cImV4cHJcIiAtPiBfZGF0YS50eXBlID09PSAndHlwZScgIHx8ICBfc3RhdGUudmlzaWJsZSA9PT0gdHJ1ZVxuICpcbiAqIEluIHJlbmRlciBmdW5jdGlvbiBzaG91bGQgYmUgXG4gKiAxLiBfbWV0aG9kcy5zdWJtaXRGb3JtKCk7XG4gKiAyLiBzdHlsZShbJ3Rlc3QnLCBfc3RhdGUuc29tZSgpLCBfY29tcHV0ZWQuc29tZSgpIF0pICB8fCAgWyd0ZXN0JywgX2RhdGEucGFkZGluZ1RvcF0gIFNIT1VMRCBOT1QgQkUgQ0FMTEVEIEJFQ0FVU0UgUkVBQ1RJVkVcbiAqIDMuIFxuICogNC4gIF9kYXRhLnR5cGUgIHx8ICAoKSA9PiB7IHJldHVybiBfc3RhdGUudmlzaWJsZSgpIH0gT1IgX3N0YXRlLnZpc2libGVcbiAqIFxuICogQHJldHVybiB7W3R5cGVdfSAgICAgICAgIFtkZXNjcmlwdGlvbl1cbiAqL1xuZnVuY3Rpb24gcGFyc2VPcHRpb25WYWx1ZShjb250ZXh0LCBrZXksIHZhbHVlKVxue1xuXHRsZXQgc3RhdGVmdWxsID0gZmFsc2U7XG5cdGxldCBrZWVwT2JzZXJ2YXRpb24gPSBmYWxzZTtcblx0bGV0IGlzRXhwcmVzc2lvbiA9IGZhbHNlO1xuXG5cdGlmKGtleVswXSA9PT0gJyQnKSB7XG5cdFx0cmV0dXJuIHtcblx0XHRcdHZhbHVlLFxuXHRcdFx0c3RhdGVmdWxsLFxuXHRcdH1cblx0fVxuXG5cdGlmKGtleVswXSA9PT0gJ0AnKSB7XG5cdFx0aXNFeHByZXNzaW9uID0gdHJ1ZTtcblx0XHRzdGF0ZWZ1bGwgPSB0cnVlO1xuXHR9XG5cblx0aWYoa2V5WzBdID09PSAnOicpIHtcblx0XHRpc0V4cHJlc3Npb24gPSB0cnVlO1xuXHR9XG5cblx0aWYodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuXHRcdGtlZXBPYnNlcnZhdGlvbiA9IHRydWU7XG5cdH1cblxuXHRpZihrZXlbMF0gPT09ICdfJykge1xuXHRcdHZhbHVlID0gJ2AnICsgdmFsdWUucmVwbGFjZSgve3soKD86KD8hKH19KSkuKSspfX0vZywgJyR7JDF9JykgKyAnYCc7XG5cdFx0a2VlcE9ic2VydmF0aW9uID0gdHJ1ZTtcblx0XHRpc0V4cHJlc3Npb24gPSB0cnVlO1xuXHR9XG5cblx0aWYoIWlzRXhwcmVzc2lvbikge1xuXHRcdHJldHVybiB7XG5cdFx0XHR2YWx1ZTogYCcke3ZhbHVlfSdgLFxuXHRcdFx0c3RhdGVmdWxsOiBmYWxzZSxcblx0XHR9XG5cdH1cblxuXHRsZXQgZXhwID0gZXhwcmVzc2lvbihjb250ZXh0LCB2YWx1ZSwga2VlcE9ic2VydmF0aW9uKTtcblx0XG5cdHZhbHVlID0gZXhwLnZhbHVlO1xuXG5cdGlmKCFzdGF0ZWZ1bGwgJiYgZXhwLnN0YXRlZnVsbCkge1xuXHRcdHN0YXRlZnVsbCA9IHRydWU7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdHZhbHVlLFxuXHRcdHN0YXRlZnVsbCxcblx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VPcHRpb25LZXkoa2V5LCB2YWx1ZSlcbntcblx0aWYoQXR0cnNNYXBba2V5XSkge1xuXHRcdHJldHVybiBBdHRyc01hcFtrZXldO1xuXHR9IGVsc2UgaWYoa2V5WzBdID09PSAnQCcpIHtcblx0XHRyZXR1cm4ga2V5LnJlcGxhY2UoL0AvZywgJ29uJyk7XG5cdH1cblxuXHRyZXR1cm4ga2V5O1xufVxuXG5mdW5jdGlvbiBwYXJzZVN0eWxlcyhzdHJpbmcpXG57XG5cdGxldCBzdHlsZXMgPSB7fTtcblx0bGV0IHBhaXJzID0gc3RyaW5nLnJlcGxhY2UoL1xccy9nLCAnJykuc3BsaXQoJzsnKTtcblx0XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgcGFpcnMubGVuZ3RoOyBpKyspIHtcblx0XHRsZXQgdG1wID0gcGFpcnNbaV0uc3BsaXQoJzonKTtcblx0XHRpZih0bXAubGVuZ3RoID09PSAyKSB7XG5cdFx0XHRzdHlsZXNbdG1wWzBdXSA9IHRtcFsxXTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gc3R5bGVzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZU9wdGlvbktleSh2YXJpYWJsZSlcbntcblx0aWYodmFyaWFibGUubWF0Y2goL1xcLS9nKSkge1xuXHRcdHZhcmlhYmxlID0gYCcke3ZhcmlhYmxlfSdgO1xuXHR9XG5cblx0cmV0dXJuIHZhcmlhYmxlO1xufVxuXG5cbi8qKlxuICogTWFrZSBhIG1hcCBhbmQgcmV0dXJuIGEgZnVuY3Rpb24gZm9yIGNoZWNraW5nIGlmIGEga2V5XG4gKiBpcyBpbiB0aGF0IG1hcC5cbiAqL1xuZnVuY3Rpb24gbWFrZU1hcCAoXG4gIHN0cixcbiAgZXhwZWN0c0xvd2VyQ2FzZVxuKSB7XG4gIHZhciBtYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICB2YXIgbGlzdCA9IHN0ci5zcGxpdCgnLCcpO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICBtYXBbbGlzdFtpXV0gPSB0cnVlO1xuICB9XG4gIHJldHVybiBleHBlY3RzTG93ZXJDYXNlXG4gICAgPyBmdW5jdGlvbiAodmFsKSB7IHJldHVybiBtYXBbdmFsLnRvTG93ZXJDYXNlKCldOyB9XG4gICAgOiBmdW5jdGlvbiAodmFsKSB7IHJldHVybiBtYXBbdmFsXTsgfVxufVxuXG4vKipcbiAqIFtkeW5hbWljQXJnQXR0cmlidXRlIGRlc2NyaXB0aW9uXVxuICogQHR5cGUge1JlZ0V4cH1cbiAqL1xudmFyIGR5bmFtaWNBcmdBdHRyaWJ1dGUgPSAvXihcXEB8XFw6KS9nO1xudmFyIGV2ZW50QXJnQXR0cmlidXRlID0gL15cXEAvZztcblxuLyoqXG4gKiBLZWVwIG9wdGlvbnMgd2hpbGUgaHlkcmF0aW9uXG4gKiBlLmcgZXZlbnRzLCBzdGF0aWMgY2xhc3MsIHByb3BzXG4gKiBAdHlwZSB7QXJyYXl9XG4gKi9cbnZhciBpc0h5ZHJhdGlvbktlZXBBdHRyID0gbWFrZU1hcCgnc3RhdGljQ2xhc3MsIHN0YXRpY1N0eWxlLCBwcm9wcywgb24nKTtcblxudmFyIGlzRnVuY3Rpb25BdHRyID0gbWFrZU1hcCgna2V5LCByZWYnKTtcblxudmFyIGlzQXR0ciA9IG1ha2VNYXAoXG5cdCdhY2NlcHQsYWNjZXB0LWNoYXJzZXQsYWNjZXNza2V5LGFjdGlvbixhbGlnbixhbHQsYXN5bmMsYXV0b2NvbXBsZXRlLCcgK1xuXHQnYXV0b2ZvY3VzLGF1dG9wbGF5LGF1dG9zYXZlLGJnY29sb3IsYm9yZGVyLGJ1ZmZlcmVkLGNoYWxsZW5nZSxjaGFyc2V0LCcgK1xuXHQnY2hlY2tlZCxjaXRlLGNsYXNzLGNvZGUsY29kZWJhc2UsY29sb3IsY29scyxjb2xzcGFuLGNvbnRlbnQsaHR0cC1lcXVpdiwnICtcblx0J25hbWUsY29udGVudGVkaXRhYmxlLGNvbnRleHRtZW51LGNvbnRyb2xzLGNvb3JkcyxkYXRhLGRhdGV0aW1lLGRlZmF1bHQsJyArXG5cdCdkZWZlcixkaXIsZGlybmFtZSxkaXNhYmxlZCxkb3dubG9hZCxkcmFnZ2FibGUsZHJvcHpvbmUsZW5jdHlwZSxtZXRob2QsZm9yLCcgK1xuXHQnZm9ybSxmb3JtYWN0aW9uLGhlYWRlcnMsaGVpZ2h0LGhpZGRlbixoaWdoLGhyZWYsaHJlZmxhbmcsaHR0cC1lcXVpdiwnICtcblx0J2ljb24saWQsaXNtYXAsaXRlbXByb3Asa2V5dHlwZSxraW5kLGxhYmVsLGxhbmcsbGFuZ3VhZ2UsbGlzdCxsb29wLGxvdywnICtcblx0J21hbmlmZXN0LG1heCxtYXhsZW5ndGgsbWVkaWEsbWV0aG9kLEdFVCxQT1NULG1pbixtdWx0aXBsZSxlbWFpbCxmaWxlLCcgK1xuXHQnbXV0ZWQsbmFtZSxub3ZhbGlkYXRlLG9wZW4sb3B0aW11bSxwYXR0ZXJuLHBpbmcscGxhY2Vob2xkZXIscG9zdGVyLCcgK1xuXHQncHJlbG9hZCxyYWRpb2dyb3VwLHJlYWRvbmx5LHJlbCxyZXF1aXJlZCxyZXZlcnNlZCxyb3dzLHJvd3NwYW4sc2FuZGJveCwnICtcblx0J3Njb3BlLHNjb3BlZCxzZWFtbGVzcyxzZWxlY3RlZCxzaGFwZSxzaXplLHR5cGUsdGV4dCxwYXNzd29yZCxzaXplcyxzcGFuLCcgK1xuXHQnc3BlbGxjaGVjayxzcmMsc3JjZG9jLHNyY2xhbmcsc3Jjc2V0LHN0YXJ0LHN0ZXAsc3R5bGUsc3VtbWFyeSx0YWJpbmRleCwnICtcblx0J3RhcmdldCx0aXRsZSx0eXBlLHVzZW1hcCx2YWx1ZSx3aWR0aCx3cmFwJ1xuKTtcblxudmFyIGlzTm90Q2FsbGFibGUgPSBtYWtlTWFwKCcnKTtcbnZhciBpc0V2ZW50QXR0ciA9IGZ1bmN0aW9uIChuYW1lKSB7XG5cdHJldHVybiAoXG5cdFx0bmFtZS5tYXRjaChldmVudEFyZ0F0dHJpYnV0ZSlcblx0KTtcbn1cblxudmFyIGlzQ1NTQXR0ciA9IGZ1bmN0aW9uIChuYW1lKSB7XG5cdHJldHVybiAoXG5cdFx0bmFtZS5tYXRjaCgvXlxcOj8oc3R5bGV8Y2xhc3MpJC9nKVxuXHQpO1xufVxuXG52YXIgaXNSZW5kZXJhYmxlQXR0ciA9IGZ1bmN0aW9uIChuYW1lKSB7XG5cdHJldHVybiAoXG5cdGlzQXR0cihuYW1lKSB8fFxuXHRcdG5hbWUuaW5kZXhPZignZGF0YS0nKSA9PT0gMCB8fFxuXHRcdG5hbWUuaW5kZXhPZignYXJpYS0nKSA9PT0gMFxuXHQpXG59O1xuXG52YXIgaXNBcmdOb3RIeWRyYXRhYmxlID0gZnVuY3Rpb24gKHR5cGUsIGFyZykge1xuXHRpZih0eXBlID09PSBudWxsKSB7XG5cdFx0dHlwZSA9IGFyZztcblx0fVxuXG5cdHJldHVybiAoIWlzSHlkcmF0aW9uS2VlcEF0dHIodHlwZSkpXG59O1xuXG52YXIgbm9ybWFsaXplVmFsdWUgPSBmdW5jdGlvbiAodmFsdWUpXG57XG5cdGlmKHZhbHVlID09PSAnJykge1xuXHRcdHZhbHVlID0gdHJ1ZTtcblx0fVxuXG5cdGlmKHR5cGVvZiB2YWx1ZSAhPT0gJ2Jvb2xlYW4nKSB7XG5cdFx0dmFsdWUgPSBgXCIke3ZhbHVlfVwiYDtcblx0fVxuXG5cdHJldHVybiB2YWx1ZTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlQXR0cnNWYWx1ZShjb250ZXh0LCB2YWx1ZSwgc2hvdWxkQmVDYWxsYWJsZSA9IHRydWUpXG57XG5cdGxldCBzdGF0ZWZ1bGwgPSBmYWxzZTtcblxuXHRsZXQgZXhwID0gZXhwcmVzc2lvbihjb250ZXh0LCB2YWx1ZSwgc2hvdWxkQmVDYWxsYWJsZSk7XG5cdFxuXHR2YWx1ZSA9IGV4cC52YWx1ZTtcblxuXHRpZighc3RhdGVmdWxsICYmIGV4cC5zdGF0ZWZ1bGwpIHtcblx0XHRzdGF0ZWZ1bGwgPSB0cnVlO1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHR2YWx1ZSxcblx0XHRzdGF0ZWZ1bGwsXG5cdH07XG59XG5cbmZ1bmN0aW9uIGdlbk9wdGlvbnMob3B0aW9ucylcbntcblx0bGV0IHJlc3VsdCA9ICcnO1xuXG5cdGZvcihsZXQga2V5IGluIG9wdGlvbnMpIHtcblx0XHRsZXQgdmFsdWUgPSBvcHRpb25zW2tleV07XG5cblx0XHRpZih0eXBlb2Ygb3B0aW9uc1trZXldID09PSAnb2JqZWN0Jykge1xuXHRcdFx0dmFsdWUgPSBnZW5PcHRpb25zKHZhbHVlKTtcblx0XHRcdGlmKHZhbHVlID09PSBudWxsKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXN1bHQgKz0gYCcke2tleX0nOiB7IFxcbiAkeyB2YWx1ZSB9IFxcbn0sXFxuYDtcblx0XHR9IGVsc2Uge1xuXHRcdFx0aWYodmFsdWUgPT0gJycpIHtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cblx0XHRcdHJlc3VsdCArPSBgJyR7a2V5fSc6ICR7IHZhbHVlIH0sXFxuYDtcblx0XHR9XG5cdH1cblxuXHRpZihyZXN1bHQgPT0gJycpIHtcblx0XHRyZXR1cm4gbnVsbDtcblx0fVxuXG5cdHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIHBhcnNlQXR0cnMoY29udGV4dCwgYXR0cnMsIGh5ZHJhdGUgPSBmYWxzZSlcbntcblx0bGV0IHNob3VsZE9wdGlvbnNIeWRyYXRlID0gZmFsc2U7XG5cblx0bGV0IG9wdGlvbnMgPSB7XG5cdFx0c3RhdGljQ2xhc3M6ICcnLFxuXHRcdHN0YXRpY1N0eWxlOiB7fSxcblx0XHRjbGFzczogW10sXG5cdFx0c3R5bGU6IFtdLFxuXHRcdGF0dHJzOiB7fSxcblx0XHRvbjoge30sXG5cdFx0ZG9tUHJvcHM6IHt9LFxuXHRcdHByb3BzOiB7fSxcblx0fTtcblxuXHRmb3IobGV0IGtleSBpbiBhdHRycylcblx0e1xuXHRcdGxldCBhcmcgPSBrZXkucmVwbGFjZShkeW5hbWljQXJnQXR0cmlidXRlLCAnJyk7XG5cdFx0bGV0IGF0dHJWYWx1ZSA9IGF0dHJzW2tleV07XG5cblx0XHRpZihhcmcubWF0Y2goL152XFwtL2cpKSB7XG5cdFx0XHRjb250aW51ZTtcblx0XHR9XG5cdFx0XG5cdFx0aWYoa2V5Lm1hdGNoKGR5bmFtaWNBcmdBdHRyaWJ1dGUpKSB7XG5cdFx0XHRsZXQgeyB2YWx1ZSwgc3RhdGVmdWxsIH0gPSBoYW5kbGVBdHRyc1ZhbHVlKGNvbnRleHQsIGF0dHJWYWx1ZSwgIWlzTm90Q2FsbGFibGUoYXJnKSk7XG5cblx0XHRcdGxldCB0eXBlID0gZmFsc2U7XG5cblx0XHRcdGlmKGlzRXZlbnRBdHRyKGtleSkpIHtcblx0XHRcdFx0dHlwZSA9ICdvbic7XG5cdFx0XHRcdHN0YXRlZnVsbCA9IHRydWU7XG5cdFx0XHR9IGVsc2UgaWYoaXNGdW5jdGlvbkF0dHIoYXJnKSkge1xuXHRcdFx0XHR0eXBlID0gbnVsbDtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmKGlzQ1NTQXR0cihrZXkpKSB7XG5cdFx0XHRcdFx0dHlwZSA9IG51bGw7XG5cdFx0XHRcdFx0c3RhdGVmdWxsID0gdHJ1ZTtcblx0XHRcdFx0fSBlbHNlIGlmKGlzUmVuZGVyYWJsZUF0dHIoYXJnKSkge1xuXHRcdFx0XHRcdHR5cGUgPSAnYXR0cnMnO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHR5cGUgPSAncHJvcHMnO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdGlmKHN0YXRlZnVsbCkge1xuXHRcdFx0XHRzaG91bGRPcHRpb25zSHlkcmF0ZSA9IHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHR5cGUgPT09IGZhbHNlKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihoeWRyYXRlICYmICFzdGF0ZWZ1bGwgJiYgaXNBcmdOb3RIeWRyYXRhYmxlKHR5cGUsIGFyZykpIHtcblx0XHRcdFx0Y29udGludWU7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHR5cGUgPT09IG51bGwpIHtcblx0XHRcdFx0b3B0aW9uc1thcmddID0gdmFsdWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRvcHRpb25zW3R5cGVdW2FyZ10gPSB2YWx1ZTtcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0bGV0IHZhbHVlID0gYXR0clZhbHVlO1xuXHRcdFx0bGV0IG5vcm1hbGl6ZWRWYWx1ZSA9IG51bGw7XG5cdFx0XHRsZXQgdHlwZSA9IGZhbHNlO1xuXG5cdFx0XHRpZihhcmcgPT09ICdjbGFzcycpIHtcblx0XHRcdFx0YXJnID0gJ3N0YXRpY0NsYXNzJztcblx0XHRcdFx0dHlwZSA9IG51bGw7XG5cdFx0XHRcdG5vcm1hbGl6ZWRWYWx1ZSA9IG5vcm1hbGl6ZVZhbHVlKHZhbHVlKTtcblx0XHRcdH0gZWxzZSBpZihhcmcgPT09ICdzdHlsZScpIHtcblx0XHRcdFx0YXJnID0gJ3N0YXRpY1N0eWxlJztcblx0XHRcdFx0dHlwZSA9IG51bGw7XG5cdFx0XHRcdG5vcm1hbGl6ZWRWYWx1ZSA9IHt9XG5cblx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5zcGxpdCgnOycpO1xuXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdFx0bGV0IHRtcCA9IHZhbHVlW2ldLnNwbGl0KCc6JykubWFwKChpdGVtKSA9PiBpdGVtLnRyaW0oKSk7XG5cdFx0XHRcdFx0aWYodG1wLmxlbmd0aCA9PT0gMikge1xuXHRcdFx0XHRcdFx0bm9ybWFsaXplZFZhbHVlW3RtcFswXV0gPSBub3JtYWxpemVWYWx1ZSh0bXBbMV0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIGlmKGlzRnVuY3Rpb25BdHRyKGFyZykpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKGBBdHRyaWJ1dGUgJHthcmd9IHNob3VsZCBieSBkeW5hbWljYCk7XG5cdFx0XHR9IGVsc2UgaWYoaXNSZW5kZXJhYmxlQXR0cihhcmcpKSB7XG5cdFx0XHRcdHR5cGUgPSAnYXR0cnMnO1xuXHRcdFx0XHRub3JtYWxpemVkVmFsdWUgPSAgbm9ybWFsaXplVmFsdWUodmFsdWUpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dHlwZSA9ICdwcm9wcyc7XG5cdFx0XHRcdG5vcm1hbGl6ZWRWYWx1ZSA9ICBub3JtYWxpemVWYWx1ZSh2YWx1ZSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHR5cGUgPT09IGZhbHNlKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihoeWRyYXRlICYmIGlzQXJnTm90SHlkcmF0YWJsZSh0eXBlLCBhcmcpKSB7XG5cdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0fVxuXG5cdFx0XHRpZih0eXBlID09PSBudWxsKSB7XG5cdFx0XHRcdG9wdGlvbnNbYXJnXSA9IG5vcm1hbGl6ZWRWYWx1ZTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG9wdGlvbnNbdHlwZV1bYXJnXSA9IG5vcm1hbGl6ZWRWYWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0Ly8gSXMgZXhwcmVzc2lvbiBpbnNpZGVcblx0XHRcblx0fVxuXG5cdC8vIGlmKGh5ZHJhdGUpIHtcblx0Ly8gXHRpZihvcHRpb25zLmNsYXNzLmxlbmd0aCA9PT0gMCkge1xuXHQvLyBcdFx0ZGVsZXRlIG9wdGlvbnMuc3RhdGljQ2xhc3M7XG5cdC8vIFx0fVxuXG5cdC8vIFx0aWYob3B0aW9ucy5zdHlsZS5sZW5ndGggPT09IDApIHtcblx0Ly8gXHRcdGRlbGV0ZSBvcHRpb25zLnN0YXRpY1N0eWxlO1xuXHQvLyBcdH1cblx0Ly8gfVxuXG5cdC8vIGNvbnNvbGUubG9nKG9wdGlvbnMpO1xuXHQvLyBjb25zb2xlLmxvZyhnZW5PcHRpb25zKG9wdGlvbnMpKTtcblx0Ly8gY29uc29sZS5sb2coc2hvdWxkT3B0aW9uc0h5ZHJhdGUpO1xuXHRvcHRpb25zID0gZ2VuT3B0aW9ucyhvcHRpb25zKTtcblxuXHRyZXR1cm4ge1xuXHRcdG9wdGlvbnM6IG9wdGlvbnMgPT09IG51bGwgPyAnJyA6IG9wdGlvbnMsXG5cdFx0c2hvdWxkT3B0aW9uc0h5ZHJhdGUsXG5cdH1cbn1cblxuZXhwb3J0IHsgcGFyc2VBdHRycywgcGFyc2VPcHRpb25LZXksIHBhcnNlT3B0aW9uVmFsdWUgfTtcbiJdfQ==